@use 'style/theme';
@use 'style/splitter';
@use 'style/sidebar';
@use 'style/bottompanel';

.debug-parent {
  position: relative;
  height: 0;
  top: 50%;
  opacity: 0.35;
}
.debug-dimensions {
  position: absolute;
  transform: translate(-50%, -50%);
  pointer-events: none;
  line-height: 0.8;
  left: 50%;

  &.width {
    border-top: 1px solid red;
  }

  &.height {
    border-left: 1px solid red;
  }
}

.editor-frame {
  display: flex;
}

.editor-and-tools-panel {
  display: flex;
  flex-direction: column;
  position: relative;
  z-index: 3;
  flex-grow: 1;
}

.editor-main {
  flex-grow: 1;
  position: relative;
}


// ===== Graph Drawing =====
rect.undo {
  fill: var(--comment);
  fill-opacity: 0.7;
}

rect.undo.current {
  stroke-width: 1.25;
  stroke: var(--comment);
}

rect.redo {
  fill: var(--comment);
  fill-opacity: 0.7;
}

// ===== ACCESSIBILITY ENHANCEMENTS =====
// Support reduced motion preferences
@media (prefers-reduced-motion: reduce) {
  .collapse-button,
  .collapse-icon {
    transition-duration: 0.1s;
  }
}

// High contrast mode support
@media (prefers-contrast: high) {
  .collapse-button {
    border-width: 2px;
    box-shadow: 0 0 0 1px var(--foreground);
  }
}

// ========= ERRORS ==========
.error {
  &.graph-not-loaded {
    background-color: var(--red);
    font-weight: bold;
    width: 100%;
    height: 100%;
    text-align: center;
  }
}


















.arrowhead {
  fill: var(--foreground);
}

.phantom-arrowhead {
  stroke: var(--comment);
}

.link {
  fill: none;

  :not(.background) {
    stroke: var(--comment);
    stroke-width: 3;
    marker-end: url("#arrowhead");
  }

  &.background {
    stroke: var(--foreground);
    stroke-width: 5;
  }
}

// Base node styling
.graph-node {
  r: 7px;
  fill: var(--current-line);
  stroke: var(--comment);
  stroke-width: 1.5;
  cursor: pointer;
  transition: all 0.2s ease;

  &:hover {
    stroke-width: 2.5;
    stroke: var(--foreground);
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
  }

  // Larger radii for important nodes; smaller for less-important.
  &.start,
  &.terminal,
  &.current {
    r: 8px; // Slightly larger for emphasis
    stroke-width: 2.5;

    &:hover {
      stroke-width: 3.5;
    }
  }

  &.selected {
    r: 9px; // Most prominent when selected
    stroke-width: 3;

    &:hover {
      stroke-width: 4;
    }
  }

  &.disconnected {
    r: 6px; // Slightly smaller for disconnected
    stroke-width: 1;
  }

  &.phantom {
    r: 8px; // Slightly larger for discoverability
  }

  // 1. Start Node
  &.start {
    fill: var(--green);
    stroke: var(--green);
    stroke-width: 2;
    
    &:hover {
      stroke: var(--green);
      stroke-width: 3;
      filter: drop-shadow(0 2px 6px rgba(80, 250, 123, 0.4));
    }
  }

  // 2. Terminal Nodes  
  &.terminal {
    fill: var(--red);
    stroke: var(--red);
    stroke-width: 3; // Thicker border for emphasis
    
    &:hover {
      stroke: var(--red);
      stroke-width: 4;
      filter: drop-shadow(0 2px 6px rgba(255, 85, 85, 0.4));
    }
  }
  
  // 3. Disconnected Nodes
  &.disconnected {
    fill: transparent;
    stroke: var(--comment);
    stroke-width: 2;
    stroke-dasharray: 5, 3; // Dashed border
    
    &:hover {
      stroke: var(--comment);
      stroke-dasharray: 5, 3; // Keep dashed on hover
      fill: rgba(98, 114, 164, 0.1); // --comment with low opacity
    }
  }

  // 4. User-Selected Nodes
  &.selected {
    fill: var(--purple);
    stroke: var(--purple);
    stroke-width: 3;
    filter: drop-shadow(0 2px 8px rgba(189, 147, 249, 0.5));
    
    &:hover {
      stroke-width: 4;
      filter: drop-shadow(0 4px 12px rgba(189, 147, 249, 0.6));
    }
  }

  // 5. Current Node (Programmatic Focus)
  &.current {
    fill: var(--cyan);
    stroke: var(--cyan);
    stroke-width: 3;
    animation: current-node-pulse 2s ease-in-out infinite;
    
    &:hover {
      animation: current-node-pulse 1s ease-in-out infinite; // Faster pulse on hover
    }
  }
    
  // 6. Phantom node - placeholder for potential creation
  &.phantom {
    fill: transparent;
    stroke: var(--green);
    stroke-width: 2;
    stroke-dasharray: 3, 3;
    animation: phantom-pulse 2s ease-in-out infinite;
    cursor: crosshair;
    
    &:hover {
      stroke-width: 3;
      stroke-dasharray: 0; // Solid on hover
      animation: none;
      fill: rgba(80, 250, 123, 0.1); // --green with low opacity
    }
  }
  
}

// Node text labels
.graph-node-label {
  fill: var(--foreground);
  // font-family: $font-family-monospace;
  font-size: 12px;
  text-anchor: middle;
  dominant-baseline: central;
  pointer-events: none;
  user-select: none;
}

.graph-node-start-label {
  fill: var(--background);
  font-weight: 600;
}

.graph-node-terminal-label {
  fill: var(--background);
  font-weight: 600;
}

.graph-node-disconnected-label {
  fill: var(--comment);
  opacity: 0.8;
}

.graph-node-selected-label {
  fill: var(--background);
  font-weight: 600;
}

.graph-node-current-label {
  fill: var(--background);
  font-weight: 600;
}

// Pulsing animation for current node
@keyframes current-node-pulse {
  0%, 100% {
    stroke-width: 3;
    filter: drop-shadow(0 2px 6px rgba(139, 233, 253, 0.4));
  }
  50% {
    stroke-width: 4;
    filter: drop-shadow(0 3px 10px rgba(139, 233, 253, 0.6));
  }
}

@keyframes phantom-pulse {
  0%, 100% {
    stroke: var(--green);
    opacity: 0.7;
  }
  50% {
    stroke: var(--cyan);
    opacity: 1;
  }
}
